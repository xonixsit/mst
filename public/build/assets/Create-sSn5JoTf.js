import{l as L,T as z,s as Q,q as h,b as R,w as I,a as e,d as j,u as o,i as F,e as A,g as G,c as i,f as u,h as p,p as y,o as n,F as w,r as k,t as r,j as V,v as _}from"./app-CMgtX0Ej.js";import{_ as H}from"./AppLayout-DGhDCHeo.js";const J={class:"py-12"},K={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},W={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},X={class:"p-6 border-b border-gray-200"},Z={class:"flex justify-between items-center"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},te=["value"],se={key:0,class:"text-red-500 text-sm mt-1"},oe={key:1,class:"mt-3 p-3 bg-gray-50 rounded-md"},le={class:"text-xs text-gray-600 space-y-1"},ne={key:0},ie={key:1},re={key:0,class:"text-red-500 text-sm mt-1"},de={key:0,class:"text-red-500 text-sm mt-1"},ae={key:0,class:"text-red-500 text-sm mt-1"},ue={key:0,class:"bg-blue-50 rounded-lg p-4"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},ce={class:"bg-white rounded-lg p-3"},be={class:"text-lg font-bold text-blue-600"},pe={class:"bg-white rounded-lg p-3"},xe={class:"text-lg font-bold text-green-600"},ve={class:"bg-white rounded-lg p-3"},ge={class:"text-lg font-bold text-red-600"},ye={class:"bg-white rounded-lg p-3"},_e={class:"text-lg font-bold text-gray-900"},fe={key:0},he={class:"bg-white rounded-lg overflow-hidden"},we={class:"min-w-full divide-y divide-gray-200"},ke={class:"bg-white divide-y divide-gray-200"},Se={class:"px-3 py-2 text-sm text-gray-900"},Ce={class:"px-3 py-2 text-sm text-gray-900"},Ie={class:"px-3 py-2 text-sm text-gray-900"},Ve={class:"px-3 py-2 text-sm"},qe={class:"px-3 py-2 text-sm text-gray-900"},$e={class:"space-y-4"},Te={class:"md:col-span-2"},Ue=["onUpdate:modelValue","onChange"],je=["value"],Fe=["onUpdate:modelValue","onInput"],Ae=["onUpdate:modelValue","onInput"],Ne={class:"flex items-end"},De={class:"flex-1"},Be={class:"text-lg font-medium text-gray-900"},Me=["onClick"],Ee={key:0,class:"text-red-500 text-sm mt-2"},Pe={class:"border-t pt-6"},Oe={class:"max-w-md ml-auto space-y-2"},Ye={class:"flex justify-between"},Le={class:"font-medium"},ze={class:"flex justify-between"},Qe={class:"font-medium"},Re={class:"flex justify-between text-lg font-bold border-t pt-2"},Ge={class:"flex justify-end space-x-4 pt-6 border-t"},He=["disabled"],Je={key:0},Ke={key:1},We=["disabled"],Xe={key:0},Ze={key:1},st={__name:"Create",props:{clients:Array,defaultServices:Array,preselectedClient:Object,clientFinancialSummary:Object,currentYear:Number},setup(S){var T,U;const x=S,m=L(x.clientFinancialSummary),s=z({client_id:((T=x.preselectedClient)==null?void 0:T.id)||"",title:"",comments:"",send_to_email:((U=x.preselectedClient)==null?void 0:U.email)||"",invoice_year:x.currentYear,items:[{service_name:"",quantity:1,unit_price:0}]});Q(()=>s.client_id,async d=>{if(d){const t=x.clients.find(c=>c.id==d);if(t){s.send_to_email=t.email;try{const v=await(await fetch(`/admin/clients/${d}/financial-summary`)).json();m.value=v.financial_summary}catch(c){console.error("Failed to load client financial summary:",c)}}}else m.value=null});const C=h(()=>s.items.reduce((d,t)=>d+t.quantity*t.unit_price,0)),q=h(()=>C.value*.18),N=h(()=>C.value+q.value),f=h(()=>s.client_id?x.clients.find(d=>d.id==s.client_id):null),D=()=>{s.items.push({service_name:"",quantity:1,unit_price:0})},B=d=>{s.items.splice(d,1)},M=d=>{const t=s.items[d],c=x.defaultServices.find(v=>v.name===t.service_name);c&&(t.unit_price=c.price)},$=d=>{},b=d=>parseFloat(d||0).toFixed(2),E=d=>new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),P=d=>({draft:"bg-gray-100 text-gray-800",sent:"bg-blue-100 text-blue-800",paid:"bg-green-100 text-green-800",overdue:"bg-red-100 text-red-800"})[d]||"bg-gray-100 text-gray-800",O=()=>{s.post("/admin/invoices")},Y=()=>{s.transform(d=>({...d,send_email:!0})).post("/admin/invoices")};return(d,t)=>(n(),R(H,{title:"Create Invoice"},{default:I(()=>{var c,v;return[e("div",J,[e("div",K,[e("div",W,[e("div",X,[e("div",Z,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold text-gray-900"},"Create New Invoice",-1)),j(o(F),{href:"/admin/invoices",class:"text-gray-600 hover:text-gray-900"},{default:I(()=>[...t[5]||(t[5]=[A(" ← Back to Invoices ",-1)])]),_:1})])]),e("form",{onSubmit:G(O,["prevent"]),class:"p-6 space-y-6"},[e("div",ee,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Invoice Assign To * ",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>o(s).client_id=l),class:y(["w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",{"border-red-500":o(s).errors.client_id}]),required:""},[t[7]||(t[7]=e("option",{value:""},"Select Client",-1)),(n(!0),i(w,null,k(S.clients,l=>(n(),i("option",{key:l.id,value:l.id},r(l.name)+" ("+r(l.email)+") ",9,te))),128))],2),[[V,o(s).client_id]]),o(s).errors.client_id?(n(),i("div",se,r(o(s).errors.client_id),1)):u("",!0),o(s).client_id?(n(),i("div",oe,[t[8]||(t[8]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Client Contact",-1)),e("div",le,[(c=f.value)!=null&&c.phone?(n(),i("div",ne,"Phone: "+r(f.value.phone),1)):u("",!0),(v=f.value)!=null&&v.mobile_number?(n(),i("div",ie,"Mobile: "+r(f.value.mobile_number),1)):u("",!0)])])):u("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Send to Email * ",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o(s).send_to_email=l),type:"email",class:y(["w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",{"border-red-500":o(s).errors.send_to_email}]),required:""},null,2),[[_,o(s).send_to_email]]),o(s).errors.send_to_email?(n(),i("div",re,r(o(s).errors.send_to_email),1)):u("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Invoice Title * ",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o(s).title=l),type:"text",class:y(["w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",{"border-red-500":o(s).errors.title}]),required:""},null,2),[[_,o(s).title]]),o(s).errors.title?(n(),i("div",de,r(o(s).errors.title),1)):u("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Invoice Year * ",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>o(s).invoice_year=l),class:y(["w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",{"border-red-500":o(s).errors.invoice_year}]),required:""},[...t[12]||(t[12]=[e("option",{value:"2024"},"2024",-1),e("option",{value:"2025"},"2025",-1),e("option",{value:"2026"},"2026",-1)])],2),[[V,o(s).invoice_year]]),o(s).errors.invoice_year?(n(),i("div",ae,r(o(s).errors.invoice_year),1)):u("",!0)])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Comments ",-1)),p(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>o(s).comments=l),rows:"3",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Additional comments or notes..."},null,512),[[_,o(s).comments]])]),m.value?(n(),i("div",ue,[t[21]||(t[21]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Client Financial Summary",-1)),e("div",me,[e("div",ce,[t[15]||(t[15]=e("div",{class:"text-sm font-medium text-gray-600"},"Total Invoiced",-1)),e("div",be,"$"+r(b(m.value.total_invoiced)),1)]),e("div",pe,[t[16]||(t[16]=e("div",{class:"text-sm font-medium text-gray-600"},"Total Paid",-1)),e("div",xe,"$"+r(b(m.value.total_paid)),1)]),e("div",ve,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-gray-600"},"Outstanding",-1)),e("div",ge,"$"+r(b(m.value.total_outstanding)),1)]),e("div",ye,[t[18]||(t[18]=e("div",{class:"text-sm font-medium text-gray-600"},"Invoice Count",-1)),e("div",_e,r(m.value.invoice_count),1)])]),m.value.recent_invoices&&m.value.recent_invoices.length>0?(n(),i("div",fe,[t[20]||(t[20]=e("h4",{class:"text-md font-medium text-gray-900 mb-2"},"Recent Invoices",-1)),e("div",he,[e("table",we,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Invoice #"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Title"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Amount"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Date")])],-1)),e("tbody",ke,[(n(!0),i(w,null,k(m.value.recent_invoices,l=>(n(),i("tr",{key:l.id},[e("td",Se,r(l.invoice_number),1),e("td",Ce,r(l.title),1),e("td",Ie,"$"+r(b(l.total_amount)),1),e("td",Ve,[e("span",{class:y(["px-2 py-1 text-xs font-semibold rounded-full",P(l.status)])},r(l.status),3)]),e("td",qe,r(E(l.created_at)),1)]))),128))])])])])):u("",!0)])):u("",!0),e("div",null,[e("div",{class:"flex justify-between items-center mb-4"},[t[22]||(t[22]=e("h3",{class:"text-lg font-medium text-gray-900"},"Invoice Items",-1)),e("button",{type:"button",onClick:D,class:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm"}," Add More Item ")]),e("div",$e,[(n(!0),i(w,null,k(o(s).items,(l,g)=>(n(),i("div",{key:g,class:"grid grid-cols-1 md:grid-cols-5 gap-4 p-4 border border-gray-200 rounded-md"},[e("div",Te,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Service Name * ",-1)),p(e("select",{"onUpdate:modelValue":a=>l.service_name=a,class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",onChange:a=>M(g),required:""},[t[23]||(t[23]=e("option",{value:""},"Select Service",-1)),(n(!0),i(w,null,k(S.defaultServices,a=>(n(),i("option",{key:a.name,value:a.name},r(a.name),9,je))),128))],40,Ue),[[V,l.service_name]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Quantity * ",-1)),p(e("input",{"onUpdate:modelValue":a=>l.quantity=a,type:"number",min:"1",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",onInput:a=>$(g),required:""},null,40,Fe),[[_,l.quantity,void 0,{number:!0}]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Unit Price * ",-1)),p(e("input",{"onUpdate:modelValue":a=>l.unit_price=a,type:"number",step:"0.01",min:"0",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",onInput:a=>$(g),required:""},null,40,Ae),[[_,l.unit_price,void 0,{number:!0}]])]),e("div",Ne,[e("div",De,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Total ",-1)),e("div",Be," $"+r(b(l.quantity*l.unit_price)),1)]),o(s).items.length>1?(n(),i("button",{key:0,type:"button",onClick:a=>B(g),class:"ml-2 text-red-600 hover:text-red-900 p-1"}," ✕ ",8,Me)):u("",!0)])]))),128))]),o(s).errors.items?(n(),i("div",Ee,r(o(s).errors.items),1)):u("",!0)]),e("div",Pe,[e("div",Oe,[e("div",Ye,[t[28]||(t[28]=e("span",{class:"text-gray-600"},"Subtotal:",-1)),e("span",Le,"$"+r(b(C.value)),1)]),e("div",ze,[t[29]||(t[29]=e("span",{class:"text-gray-600"},"Tax (18%):",-1)),e("span",Qe,"$"+r(b(q.value)),1)]),e("div",Re,[t[30]||(t[30]=e("span",null,"Total:",-1)),e("span",null,"$"+r(b(N.value)),1)]),t[31]||(t[31]=e("div",{class:"text-sm text-gray-500 italic"}," Tax will be auto calculated 18% once saved ",-1))])]),e("div",Ge,[j(o(F),{href:"/admin/invoices",class:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-md"},{default:I(()=>[...t[32]||(t[32]=[A(" Cancel ",-1)])]),_:1}),e("button",{type:"submit",disabled:o(s).processing,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md disabled:opacity-50"},[o(s).processing?(n(),i("span",Je,"Saving...")):(n(),i("span",Ke,"Save"))],8,He),e("button",{type:"button",onClick:Y,disabled:o(s).processing,class:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-md disabled:opacity-50"},[o(s).processing?(n(),i("span",Xe,"Saving...")):(n(),i("span",Ze,"Save & Email"))],8,We)])],32)])])])]}),_:1}))}};export{st as default};
