import{l as y,m as L,q as te,A as se,b as oe,w as J,a as e,c as a,f as v,d as le,u as ne,i as ie,e as F,h as p,y as E,o as i,v as K,t as n,F as T,r as V,g as ae,j as O}from"./app-CPDEXo_u.js";import{A as re}from"./AppLayout-CpajQrFr.js";const de={class:"py-6"},ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-4"},ce={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},me={class:"p-6 lg:p-8"},pe={class:"flex items-center justify-between mb-8"},ge={class:"flex space-x-3"},fe={class:"bg-gray-50 rounded-lg p-6 mb-8"},xe={class:"space-y-4"},ve={class:"flex items-center space-x-4"},be={class:"flex items-center"},ye={key:0,class:"flex-1"},he={key:0,class:"bg-blue-50 border border-blue-200 rounded-md p-4"},we={class:"flex items-center justify-between mb-2"},_e={class:"text-sm font-medium text-blue-900"},ke={class:"flex flex-wrap gap-2"},Ce=["onClick"],Se={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Ee={key:1,class:"border border-gray-200 rounded-md max-h-60 overflow-y-auto"},je=["onClick"],Ae={class:"flex items-center justify-between"},Fe={class:"text-sm font-medium text-gray-900"},Te={class:"text-sm text-gray-500"},Ve=["checked","onChange"],Ue={class:"bg-gray-50 rounded-lg p-6 mb-8"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Oe=["value"],Re={class:"mt-1 text-xs text-gray-500"},De={class:"mt-6 p-4 bg-white border border-gray-200 rounded-md"},Me={class:"text-sm text-gray-600"},Ie={key:0,class:"space-y-2"},qe={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},Pe=["value"],$e={class:"ml-2 text-xs"},Be={key:1},ze={class:"mt-6"},Le={class:"space-y-3"},Je={class:"flex items-center"},Ke={class:"flex items-center"},Xe={class:"flex items-center"},He={key:0,class:"bg-white border border-gray-200 rounded-lg p-6 mb-8"},We={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},Ge={class:"bg-blue-50 p-4 rounded-lg"},Qe={class:"text-2xl font-bold text-blue-600"},Ye={class:"bg-green-50 p-4 rounded-lg"},Ze={class:"text-2xl font-bold text-green-600"},et={class:"bg-yellow-50 p-4 rounded-lg"},tt={class:"text-2xl font-bold text-yellow-600"},st={class:"bg-purple-50 p-4 rounded-lg"},ot={class:"text-2xl font-bold text-purple-600"},lt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},nt={class:"bg-gray-50 p-4 rounded-lg"},it={class:"space-y-1 text-sm"},at={class:"flex justify-between"},rt={class:"flex justify-between"},dt={class:"flex justify-between"},ut={class:"bg-gray-50 p-4 rounded-lg"},ct={class:"space-y-1 text-sm"},mt={class:"flex justify-between"},pt={class:"flex justify-between"},gt={class:"flex justify-between"},ft={class:"bg-gray-50 p-4 rounded-lg"},xt={class:"space-y-1 text-sm"},vt={class:"flex justify-between"},bt={class:"flex justify-between"},yt={class:"flex justify-between"},ht={class:"flex justify-between items-center"},wt=["disabled"],_t={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24"},kt={class:"flex space-x-3"},Ct=["disabled"],St={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Et={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},jt={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},At={class:"mt-3"},Ft={class:"space-y-4"},Tt={class:"flex justify-end space-x-3 mt-6"},Nt={__name:"Export",props:{availableTemplates:Object,availableUsers:Array},setup(U){const g=y(!1),w=y(""),_=y([]),r=y([]),x=y(!1),d=y(null),j=y(!1),o=L({format:"excel",template:"comprehensive",customFields:[],includeMetadata:!1,includeSummary:!1,includeRelationships:!0}),h=L({frequency:"weekly",recipients:""}),X=[{value:"id",label:"ID"},{value:"full_name",label:"Full Name"},{value:"email",label:"Email"},{value:"phone",label:"Phone"},{value:"status",label:"Status"},{value:"address",label:"Address"},{value:"spouse_name",label:"Spouse Name"},{value:"assets_count",label:"Assets Count"},{value:"expenses_count",label:"Expenses Count"},{value:"registration_date",label:"Registration Date"}],k=te(()=>g.value||r.value.length>0),H=()=>{g.value&&(r.value=[],_.value=[],w.value="")},W=async()=>{var l;if(w.value.length<2){_.value=[];return}try{const u=await(await fetch(route("admin.clients.index",{search:w.value,per_page:20}),{headers:{Accept:"application/json"}})).json();_.value=((l=u.clients)==null?void 0:l.data)||[]}catch(t){console.error("Search failed:",t)}},R=l=>{const t=r.value.findIndex(u=>u.id===l.id);t>-1?r.value.splice(t,1):r.value.push(l)},G=l=>r.value.some(t=>t.id===l),Q=l=>{r.value=r.value.filter(t=>t.id!==l)},Y=()=>{r.value=[],g.value=!1},D=async()=>{if(k.value){x.value=!0;try{const l=g.value?[]:r.value.map(m=>m.id),u=await(await fetch(route("admin.clients.export-stats"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({client_ids:l})})).json();u.success&&(d.value=u.statistics)}catch(l){console.error("Preview failed:",l)}finally{x.value=!1}}},Z=async()=>{var l;if(k.value){x.value=!0;try{const u={client_ids:g.value?[]:r.value.map(c=>c.id),format:o.format,template:o.template,custom_fields:o.customFields,include_metadata:o.includeMetadata,include_summary:o.includeSummary,include_relationships:o.includeRelationships},m=await fetch(route("admin.clients.process-comprehensive-export"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(u)});if(m.ok){const c=await m.blob(),C=window.URL.createObjectURL(c),f=document.createElement("a");f.style.display="none",f.href=C;const S=m.headers.get("content-disposition"),A=S?(l=S.split("filename=")[1])==null?void 0:l.replace(/"/g,""):`clients_export.${o.format}`;f.download=A,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(C),document.body.removeChild(f)}else{const c=await m.json();console.error("Export failed:",c)}}catch(t){console.error("Export failed:",t)}finally{x.value=!1}}},ee=async()=>{try{const l=h.recipients.split(`
`).map(c=>c.trim()).filter(c=>c),t={frequency:h.frequency,format:o.format,template:o.template,recipients:l};(await(await fetch(route("admin.clients.schedule-automated-export"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(t)})).json()).success&&(j.value=!1)}catch(l){console.error("Schedule failed:",l)}},N=l=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l);return se(()=>{k.value&&D()}),(l,t)=>(i(),oe(re,{title:"Export Clients"},{default:J(()=>{var u,m,c,C,f,S,A,M,I,q,P,$,B,z;return[e("div",de,[e("div",ue,[e("div",ce,[e("div",me,[e("div",pe,[t[14]||(t[14]=e("div",null,[e("h1",{class:"text-2xl font-medium text-gray-900"},"Export Client Data"),e("p",{class:"mt-2 text-sm text-gray-600"}," Export client information in various formats with customizable templates and options. ")],-1)),e("div",ge,[le(ne(ie),{href:l.route("admin.clients.index"),class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:border-blue-300 focus:ring ring-blue-200 active:text-gray-800 active:bg-gray-50 disabled:opacity-25 transition ease-in-out duration-150"},{default:J(()=>[...t[13]||(t[13]=[F(" Back to Clients ",-1)])]),_:1},8,["href"])])]),e("div",fe,[t[16]||(t[16]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Select Clients to Export",-1)),e("div",xe,[e("div",ve,[e("label",be,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),type:"checkbox",onChange:H,class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,544),[[E,g.value]]),t[15]||(t[15]=e("span",{class:"ml-2 text-sm text-gray-700"},"Export all clients",-1))]),g.value?v("",!0):(i(),a("div",ye,[p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),type:"text",placeholder:"Search clients by name or email...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",onInput:W},null,544),[[K,w.value]])]))]),r.value.length>0?(i(),a("div",he,[e("div",we,[e("span",_e,n(r.value.length)+" client(s) selected for export ",1),e("button",{onClick:Y,class:"text-blue-600 hover:text-blue-800 text-sm"}," Clear selection ")]),e("div",ke,[(i(!0),a(T,null,V(r.value.slice(0,10),s=>(i(),a("span",{key:s.id,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},[F(n(s.name)+" ",1),e("button",{onClick:b=>Q(s.id),class:"ml-1 text-blue-600 hover:text-blue-800"}," Ã— ",8,Ce)]))),128)),r.value.length>10?(i(),a("span",Se," +"+n(r.value.length-10)+" more ",1)):v("",!0)])])):v("",!0),!g.value&&_.value.length>0?(i(),a("div",Ee,[(i(!0),a(T,null,V(_.value,s=>(i(),a("div",{key:s.id,class:"p-3 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 cursor-pointer",onClick:b=>R(s)},[e("div",Ae,[e("div",null,[e("div",Fe,n(s.name),1),e("div",Te,n(s.email),1)]),e("input",{checked:G(s.id),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",onClick:t[2]||(t[2]=ae(()=>{},["stop"])),onChange:b=>R(s)},null,40,Ve)])],8,je))),128))])):v("",!0)])]),e("div",Ue,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Export Configuration",-1)),e("div",Ne,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Export Format",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.format=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[...t[17]||(t[17]=[e("option",{value:"excel"},"Excel (.xlsx)",-1),e("option",{value:"csv"},"CSV (.csv)",-1),e("option",{value:"pdf"},"PDF (.pdf)",-1),e("option",{value:"json"},"JSON (.json)",-1)])],512),[[O,o.format]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Export Template",-1)),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.template=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[(i(!0),a(T,null,V(U.availableTemplates,(s,b)=>(i(),a("option",{key:b,value:b},n(s.name),9,Oe))),128))],512),[[O,o.template]]),e("p",Re,n((u=U.availableTemplates[o.template])==null?void 0:u.description),1)])]),e("div",De,[t[21]||(t[21]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Template Fields",-1)),e("div",Me,[o.template==="custom"?(i(),a("div",Ie,[t[20]||(t[20]=e("p",{class:"font-medium"},"Select fields to include:",-1)),e("div",qe,[(i(),a(T,null,V(X,s=>e("label",{key:s.value,class:"flex items-center"},[p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=b=>o.customFields=b),value:s.value,type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,8,Pe),[[E,o.customFields]]),e("span",$e,n(s.label),1)])),64))])])):(i(),a("div",Be,[e("p",null,n((m=U.availableTemplates[o.template])==null?void 0:m.fields.join(", ")),1)]))])]),e("div",ze,[t[25]||(t[25]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Export Options",-1)),e("div",Le,[e("label",Je,[p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.includeMetadata=s),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[E,o.includeMetadata]]),t[22]||(t[22]=e("span",{class:"ml-2 text-sm text-gray-600"},"Include export metadata",-1))]),e("label",Ke,[p(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.includeSummary=s),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[E,o.includeSummary]]),t[23]||(t[23]=e("span",{class:"ml-2 text-sm text-gray-600"},"Include summary statistics",-1))]),e("label",Xe,[p(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.includeRelationships=s),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[E,o.includeRelationships]]),t[24]||(t[24]=e("span",{class:"ml-2 text-sm text-gray-600"},"Include relationship data (spouse, assets, etc.)",-1))])])])]),d.value?(i(),a("div",He,[t[43]||(t[43]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Export Preview",-1)),e("div",We,[e("div",Ge,[e("div",Qe,n(d.value.total_clients),1),t[27]||(t[27]=e("div",{class:"text-sm text-blue-600"},"Total Clients",-1))]),e("div",Ye,[e("div",Ze,n(((c=d.value.status_breakdown)==null?void 0:c.active)||0),1),t[28]||(t[28]=e("div",{class:"text-sm text-green-600"},"Active",-1))]),e("div",et,[e("div",tt,n(((C=d.value.relationship_counts)==null?void 0:C.with_spouse)||0),1),t[29]||(t[29]=e("div",{class:"text-sm text-yellow-600"},"With Spouse",-1))]),e("div",st,[e("div",ot,n(((f=d.value.relationship_counts)==null?void 0:f.total_assets)||0),1),t[30]||(t[30]=e("div",{class:"text-sm text-purple-600"},"Total Assets",-1))])]),e("div",lt,[e("div",nt,[t[34]||(t[34]=e("h4",{class:"font-medium text-gray-900 mb-2"},"Status Breakdown",-1)),e("div",it,[e("div",at,[t[31]||(t[31]=e("span",null,"Active:",-1)),e("span",null,n(((S=d.value.status_breakdown)==null?void 0:S.active)||0),1)]),e("div",rt,[t[32]||(t[32]=e("span",null,"Inactive:",-1)),e("span",null,n(((A=d.value.status_breakdown)==null?void 0:A.inactive)||0),1)]),e("div",dt,[t[33]||(t[33]=e("span",null,"Archived:",-1)),e("span",null,n(((M=d.value.status_breakdown)==null?void 0:M.archived)||0),1)])])]),e("div",ut,[t[38]||(t[38]=e("h4",{class:"font-medium text-gray-900 mb-2"},"Relationship Data",-1)),e("div",ct,[e("div",mt,[t[35]||(t[35]=e("span",null,"Employees:",-1)),e("span",null,n(((I=d.value.relationship_counts)==null?void 0:I.total_employees)||0),1)]),e("div",pt,[t[36]||(t[36]=e("span",null,"Projects:",-1)),e("span",null,n(((q=d.value.relationship_counts)==null?void 0:q.total_projects)||0),1)]),e("div",gt,[t[37]||(t[37]=e("span",null,"Expenses:",-1)),e("span",null,n(((P=d.value.relationship_counts)==null?void 0:P.total_expenses)||0),1)])])]),e("div",ft,[t[42]||(t[42]=e("h4",{class:"font-medium text-gray-900 mb-2"},"Financial Summary",-1)),e("div",xt,[e("div",vt,[t[39]||(t[39]=e("span",null,"Asset Value:",-1)),e("span",null,"$"+n(N((($=d.value.financial_summary)==null?void 0:$.total_asset_value)||0)),1)]),e("div",bt,[t[40]||(t[40]=e("span",null,"Expenses:",-1)),e("span",null,"$"+n(N(((B=d.value.financial_summary)==null?void 0:B.total_expense_amount)||0)),1)]),e("div",yt,[t[41]||(t[41]=e("span",null,"Invoices:",-1)),e("span",null,"$"+n(N(((z=d.value.financial_summary)==null?void 0:z.total_invoice_amount)||0)),1)])])])])])):v("",!0),e("div",ht,[e("button",{onClick:D,disabled:!k.value||x.value,class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:border-blue-300 focus:ring ring-blue-200 active:text-gray-800 active:bg-gray-50 disabled:opacity-25 transition ease-in-out duration-150"},[x.value?(i(),a("svg",_t,[...t[44]||(t[44]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):v("",!0),t[45]||(t[45]=F(" Preview Export ",-1))],8,wt),e("div",kt,[e("button",{onClick:t[9]||(t[9]=s=>j.value=!0),class:"inline-flex items-center px-4 py-2 bg-gray-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150"}," Schedule Export "),e("button",{onClick:Z,disabled:!k.value||x.value,class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:border-indigo-900 focus:ring ring-indigo-300 disabled:opacity-25 transition ease-in-out duration-150"},[x.value?(i(),a("svg",St,[...t[46]||(t[46]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):v("",!0),t[47]||(t[47]=F(" Export Now ",-1))],8,Ct)])])])])])]),j.value?(i(),a("div",Et,[e("div",jt,[e("div",At,[t[51]||(t[51]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Schedule Automated Export",-1)),e("div",Ft,[e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Frequency",-1)),p(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>h.frequency=s),class:"block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[...t[48]||(t[48]=[e("option",{value:"daily"},"Daily",-1),e("option",{value:"weekly"},"Weekly",-1),e("option",{value:"monthly"},"Monthly",-1)])],512),[[O,h.frequency]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email Recipients",-1)),p(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>h.recipients=s),placeholder:"Enter email addresses, one per line",rows:"3",class:"block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[K,h.recipients]])])]),e("div",Tt,[e("button",{onClick:t[12]||(t[12]=s=>j.value=!1),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors"}," Cancel "),e("button",{onClick:ee,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors"}," Schedule ")])])])])):v("",!0)]}),_:1}))}};export{Nt as default};
